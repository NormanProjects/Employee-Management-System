<div class="leave-request-list-container">
  <!-- Header -->
  <header class="page-header">
    <div class="header-content">
      <div class="header-left">
        <button class="back-button" (click)="goBack()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
          </svg>
          Back to Dashboard
        </button>
        <h1>Leave Requests</h1>
      </div>
      <button class="logout-btn" (click)="logout()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16 17 21 12 16 7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
        Logout
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="page-content">
    
    <!-- Toolbar -->
    <div class="toolbar">
      <div class="filters">
        <!-- Status Filter -->
        <select 
          class="status-filter"
          [(ngModel)]="selectedStatus"
          (change)="filterByStatus()"
        >
          <option value="">All Statuses</option>
          <option value="PENDING">Pending</option>
          <option value="APPROVED">Approved</option>
          <option value="REJECTED">Rejected</option>
          <option value="CANCELLED">Cancelled</option>
        </select>

        <!-- Reset Button -->
        <button class="reset-btn" (click)="resetFilters()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="1 4 1 10 7 10"></polyline>
            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
          </svg>
          Reset
        </button>
      </div>

      <!-- New Request Button -->
      <button class="add-btn" (click)="createLeaveRequest()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        New Request
      </button>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="errorMessage">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      {{ errorMessage }}
    </div>

    <!-- Loading -->
    <div class="loading" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>Loading leave requests...</p>
    </div>

    <!-- Leave Requests Table -->
    <div class="table-container" *ngIf="!isLoading && !errorMessage">
      
      <!-- No Results -->
      <div class="no-results" *ngIf="filteredRequests.length === 0">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <h3>No leave requests found</h3>
        <p>Try adjusting your filters or create a new request</p>
      </div>

      <!-- Table -->
      <table class="leave-table" *ngIf="filteredRequests.length > 0">
        <thead>
          <tr>
            <th>ID</th>
            <th>Employee</th>
            <th>Leave Type</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let request of filteredRequests">
            <td>{{ request.leaveRequestId }}</td>
            <td>{{ request.employeeName }}</td>
            <td><span class="leave-type">{{ request.leaveType }}</span></td>
            <td>{{ request.startDate | date:'mediumDate' }}</td>
            <td>{{ request.endDate | date:'mediumDate' }}</td>
            <td class="reason-cell">{{ request.reason || 'N/A' }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(request.status)">
                {{ request.status }}
              </span>
            </td>
            <td class="actions">
              <!-- Approve (ADMIN/MANAGER only for PENDING) -->
              <button 
                class="action-btn approve-btn" 
                (click)="approveRequest(request.leaveRequestId!)"
                *ngIf="canApprove(request)"
                title="Approve"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </button>
              <!-- Reject (ADMIN/MANAGER only for PENDING) -->
              <button 
                class="action-btn reject-btn" 
                (click)="rejectRequest(request.leaveRequestId!)"
                *ngIf="canApprove(request)"
                title="Reject"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
              <!-- Cancel (Own requests only) -->
              <button 
                class="action-btn cancel-btn" 
                (click)="cancelRequest(request.leaveRequestId!)"
                *ngIf="canCancel(request)"
                title="Cancel"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="15" y1="9" x2="9" y2="15"></line>
                  <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Results Summary -->
      <div class="results-summary" *ngIf="filteredRequests.length > 0">
        Showing {{ filteredRequests.length }} of {{ leaveRequests.length }} leave requests
      </div>
    </div>

  </main>
</div>